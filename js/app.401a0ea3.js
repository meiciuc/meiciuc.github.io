(function(t){function e(e){for(var n,s,r=e[0],c=e[1],h=e[2],l=0,d=[];l<r.length;l++)s=r[l],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&d.push(a[s][0]),a[s]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);u&&u(e);while(d.length)d.shift()();return o.push.apply(o,h||[]),i()}function i(){for(var t,e=0;e<o.length;e++){for(var i=o[e],n=!0,r=1;r<i.length;r++){var c=i[r];0!==a[c]&&(n=!1)}n&&(o.splice(e--,1),t=s(s.s=i[0]))}return t}var n={},a={app:0},o=[];function s(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=n,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var h=0;h<r.length;h++)e(r[h]);var u=c;o.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("cd49")},"309b":function(t,e,i){},4533:function(t,e,i){t.exports=i.p+"media/asteroid.700707dc.mp3"},"58ce":function(t,e,i){t.exports=i.p+"media/asteroid.960a0b4d.ogg"},"5cd1":function(t,e,i){t.exports=i.p+"media/ship.606800c8.ogg"},"690a":function(t,e,i){"use strict";i("c032")},"7e73":function(t,e,i){t.exports=i.p+"media/shoot.164324a9.ogg"},b750:function(t,e,i){t.exports=i.p+"media/shoot.ecff5374.mp3"},c032:function(t,e,i){},cd49:function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var n=i("2b0e"),a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"wrap_container",attrs:{id:"app"}},[i("game",{staticClass:"wrap_container"})],1)},o=[],s=i("d4ec"),r=i("bee2"),c=i("262e"),h=i("2caf"),u=i("9ab4"),l=(i("309b"),i("1b40")),d=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{on:{click:t.handleClick}},[i("div",{ref:"game",staticClass:"game wrap_container"}),i("div",{staticClass:"options wrap_container"},[i("ul",{staticClass:"results"},[i("li",{staticClass:"subtitle has-text-white game-score"},[t._v("LEVEL: "+t._s(t.$store.state.storeGameModule.level))]),i("li",{staticClass:"subtitle has-text-white game-score"},[t._v("SCORE: "+t._s(t.$store.state.storeGameModule.score))]),i("li",{staticClass:"subtitle has-text-white game-lives"},[t._v("LIVES: "+t._s(t.$store.state.storeGameModule.lives))]),i("li",{staticClass:"subtitle has-text-white game-lives"},[t._v("shots: "+t._s(t.$store.state.storeGameModule.shots))]),i("li",{staticClass:"subtitle has-text-white game-lives"},[t._v("hits: "+t._s(t.$store.state.storeGameModule.hits))]),i("li",{staticClass:"subtitle has-text-white game-lives"},[t._v("precision: "+t._s(t.precision))])]),t.start?i("div",{staticClass:"center"},[t._m(0)]):t._e(),t.finish?i("div",{staticClass:"center"},[t._m(1)]):t._e()])])},v=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("h1",[t._v("ASTEROIDS")]),i("h2",[t._v("Click to start")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("h1",[t._v("GAME OVER")]),i("h2",[t._v("Click to start")])])}],m=i("1da1"),f=(i("96cf"),i("398f")),p=(i("99af"),function t(e){Object(s["a"])(this,t),this.animation=e}),g=function t(e){Object(s["a"])(this,t),this.fsm=e},y=function(){function t(){Object(s["a"])(this,t),this.toPlay=[]}return Object(r["a"])(t,[{key:"play",value:function(t){this.toPlay.push(t)}}]),t}(),w=function t(){Object(s["a"])(this,t)},b=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(s["a"])(this,t),this.radius=e},O=function t(e){Object(s["a"])(this,t),this.countdown=e},S=function t(e){Object(s["a"])(this,t),this.displayObject=e},E=function(){function t(){Object(s["a"])(this,t),this.state=t.WAIT_FOR_START,this.lives=0,this.level=0,this.hits=0,this.shots=0}return Object(r["a"])(t,[{key:"setForStart",value:function(){this.lives=3,this.level=0,this.hits=0,this.shots=0,this.state=t.PLAY}},{key:"setForFinish",value:function(){this.state=t.FINISH}},{key:"update",value:function(t){this.lives=t.lives,this.level=t.level,this.hits=t.hits,this.shots=t.shots,this.state=t.state}}]),t}();E.WAIT_FOR_START="wait",E.PLAY="play",E.PAUSE="pause",E.FINISH="finish";var _=function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(s["a"])(this,t),this.shooting=!1,this.timeSinceLastShot=0,this.offsetFromParentX=e,this.offsetFromParentY=i,this.minimumShotInterval=n,this.bulletLifetime=a},A=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(s["a"])(this,t),this.trigger=e},T=function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(s["a"])(this,t),this.velocityX=e,this.velocityY=i,this.angularVelocity=n,this.damping=a},j=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Object(s["a"])(this,t),this.left=e,this.right=i,this.accelerate=n,this.accelerationRate=a,this.rotationRate=o},M=function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(s["a"])(this,t),this.x=e,this.y=i,this.rotation=n},D=function t(e){Object(s["a"])(this,t),this.fsm=e},k=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Object(s["a"])(this,t),this.time=n,this.startX=0,this.startY=0,this.startAngle=0,this.magnitude=16,this.tiltAngle=1,this.randomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},this.displayObject=e,this.magnitude=i,this.startX=e.x,this.startY=e.y,this.startAngle=e.rotation}return Object(r["a"])(t,[{key:"animate",value:function(t){this.time-=t,this.upAndDownShake()}},{key:"upAndDownShake",value:function(){var t=this.displayObject;if(this.time>=0){t.x=this.startX,t.y=this.startY;var e=this.magnitude*this.time;t.x+=this.randomInt(-e,e),t.y+=this.randomInt(-e,e)}else t.x=this.startX,t.y=this.startY}},{key:"angularShake",value:function(){var t=this.displayObject;if(this.time>=0){var e=this.magnitude*this.time;t.rotation=this.startAngle+e*this.tiltAngle/100,this.tiltAngle*=-1}else t.rotation=this.startAngle}}]),t}(),R=i("b85c"),I=i("7aaa"),F=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(t){var n;Object(s["a"])(this,i),n=e.call(this);var a=2*Math.random()*Math.PI,o=Math.random()*t,r=10*Math.random()+10;return n.velocityX=Math.cos(a)*r,n.velocityY=Math.sin(a)*r,n.beginFill(16777215).drawCircle(0,0,1).endFill().setTransform(Math.cos(a)*o,Math.sin(a)*o),n}return i}(I["c"]),C=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(t){var n;Object(s["a"])(this,i),n=e.call(this),n.dots=[];for(var a=i.numDots,o=0;o<a;o+=1){var r=new F(t);n.addChild(r),n.dots.push(r)}return n}return Object(r["a"])(i,[{key:"animate",value:function(t){var e,i=Object(R["a"])(this.dots);try{for(i.s();!(e=i.n()).done;){var n=e.value;n.setTransform(n.x+n.velocityX*t,n.y+n.velocityY*t),n.alpha-=t/2}}catch(a){i.e(a)}finally{i.f()}}}]),i}(I["b"]);C.numDots=8;var L=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(t){var n;Object(s["a"])(this,i),n=e.call(this),n.moveTo(t,0).beginFill(16777215);var a=0;while(a<2*Math.PI){var o=(.75+.25*Math.random())*t,r=Math.cos(a)*o,c=Math.sin(a)*o;n.lineTo(r,c),a+=.5*Math.random()}return n.lineTo(t,0).endFill(),n}return i}(I["c"]),x=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(){var t;return Object(s["a"])(this,i),t=e.call(this),t.beginFill(16777215).drawCircle(0,0,2.5).endFill(),t}return i}(I["c"]),N=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(){var t;return Object(s["a"])(this,i),t=e.call(this),t.shape1=new I["c"],t.shape1.moveTo(10,0).beginFill(16777215).lineTo(-7,7).lineTo(-4,0).lineTo(10,0).endFill(),t.addChild(t.shape1),t.shape2=new I["c"],t.shape2.moveTo(10,0).beginFill(16777215).lineTo(-7,-7).lineTo(-4,0).lineTo(10,0).endFill(),t.addChild(t.shape2),t.vel1x=10*Math.random()-5,t.vel1y=10*Math.random()+10,t.vel2x=10*Math.random()-5,t.vel2y=-10*Math.random()-10,t.rot1=3*Math.random()-1.5,t.rot2=3*Math.random()-1.5,t}return Object(r["a"])(i,[{key:"animate",value:function(t){var e=this.shape1,i=this.shape2;e.setTransform(e.x+this.vel1x*t,e.y+this.vel1y*t,1,1,e.rotation+this.rot1*t),i.setTransform(i.x+this.vel2x*t,i.y+this.vel2y*t,1,1,i.rotation+this.rot2*t)}}]),i}(I["b"]),P=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(){var t;return Object(s["a"])(this,i),t=e.call(this),t.moveTo(10,0).beginFill(16777215).lineTo(-7,7).lineTo(-4,0).lineTo(-7,-7).lineTo(10,0).endFill(),t}return i}(I["c"]),X=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777215,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.2;Object(s["a"])(this,i),n=e.call(this);var c=2,h=new I["c"];if(h.beginFill(o,r).drawRect(-t/2,-c/2,t,c).endFill(),h.beginFill(o,r).drawRect(-c/2,-t/2,c,t).endFill(),n.addChild(h),a){var u=new I["e"]({fontFamily:"Arial",fontSize:12,fill:16777215}),l=new I["d"](a,u);l.setTransform(-l.width/2,-l.height/2),n.addChild(l)}return n}return i}(I["b"]),U=32,Y=37,H=39,G=38,B={GAME:"game",CAMERA:"camera"},W=function(){function t(e,i){Object(s["a"])(this,t),this.engine=e,this.config=i}return Object(r["a"])(t,[{key:"destroyEntity",value:function(t){this.engine.removeEntity(t)}},{key:"registerCameraContainer",value:function(t){var e=new f["Entity"](B.CAMERA).add(new S(t));return this.engine.addEntity(e),e}},{key:"createGame",value:function(){var t=new f["Entity"](B.GAME).add(new E);return this.engine.addEntity(t),t}},{key:"createAsteroid",value:function(t,e,i){var n=new f["Entity"],a=new f["EntityStateMachine"](n),o=4*(Math.random()-.5)*(50-t),s=4*(Math.random()-.5)*(50-t),r=2*Math.random()-1;a.createState("alive").add(T).withInstance(new T(o,s,r)).add(b).withInstance(new b(t)).add(S).withInstance(new S(new L(t)));var c=new C(t);return a.createState("destroyed").add(T).withInstance(new T(o,s,0)).add(O).withInstance(new O(3)).add(S).withInstance(new S(c)).add(p).withInstance(new p(c)),n.add(new g(a)).add(new M(e,i,0)).add(new y),a.changeState("alive"),this.engine.addEntity(n),n}},{key:"createSpaceship",value:function(){var t=new f["Entity"],e=new f["EntityStateMachine"](t),i=new T(0,0,0,15);e.createState("playing").add(T).withInstance(i).add(j).withInstance(new j(Y,H,G,100,3)).add(_).withInstance(new _(8,0,.3,2)).add(A).withInstance(new A(U)).add(b).withInstance(new b(9)).add(S).withInstance(new S(new P));var n=new N;return e.createState("destroyed").add(T).withInstance(i).add(O).withInstance(new O(5)).add(S).withInstance(new S(n)).add(p).withInstance(new p(n)),t.add(new D(e)).add(new M(this.config.width/2,this.config.height/2,0)).add(new y),e.changeState("playing"),this.engine.addEntity(t),t}},{key:"createUserBullet",value:function(t,e){var i=Math.cos(e.rotation),n=Math.sin(e.rotation),a=(new f["Entity"]).add(new w).add(new O(t.bulletLifetime)).add(new M(i*t.offsetFromParentX-n*t.offsetFromParentY+e.x,n*t.offsetFromParentX+i*t.offsetFromParentY+e.y,0)).add(new b(0)).add(new T(150*i,150*n,0,0)).add(new S(new x));return this.engine.addEntity(a),a}},{key:"createDebugCrossView",value:function(t,e,i){var n=(new f["Entity"]).add(new S(new X(t,"".concat(e,":").concat(i)))).add(new M(e,i));return this.engine.addEntity(n),n}},{key:"cameraShake",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=this.engine.getEntityByName(B.CAMERA);if(!i)return null;var n=(new f["Entity"]).add(new O(1)).add(new p(new k(i.get(S).displayObject,t,e)));return this.engine.addEntity(n),n}}]),t}(),K=function t(e,i){Object(s["a"])(this,t),this.width=e,this.height=i};K.DEFAULT_LIVES_COUNT=3,K.DEFAULT_SCREEN_SIZE_AREA=48e4,K.DEFAULT_ASTEROIDS_MIN_COUNT=2,K.DEFAULT_ASTEROID_MAX_SIZE=30,K.DEFAULT_CAMERA_SHAKE_MAGNITUDE_FOR_ASTEROID=K.DEFAULT_ASTEROID_MAX_SIZE/8,K.DEFAULT_CAMERA_SHAKE_TIME_FOR_ASTEROID=2,K.DEFAULT_CAMERA_SHAKE_MAGNITUDE_FOR_SPACESHIP=K.DEFAULT_ASTEROID_MAX_SIZE/4,K.DEFAULT_CAMERA_SHAKE_TIME_FOR_SPACESHIP=3,K.SCALE_SCREEN_TO_DEFAULT_SCREEN_SIZE_AREA=!0;i("d3b7"),i("ddb0"),i("143c"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7");var V,z=32,Z=function(){function t(){var e=this;Object(s["a"])(this,t),this.keys=new Int32Array(4),this.keyDownHandler=function(t){var i=t.keyCode,n=Math.floor(i/z);e.keys[n]|=1<<i-n*z},this.keyUpHandler=function(t){var i=t.keyCode,n=Math.floor(i/z);e.keys[n]&=~(1<<i-n*z)},window.addEventListener("keyup",this.keyUpHandler),window.addEventListener("keydown",this.keyDownHandler)}return Object(r["a"])(t,[{key:"isDown",value:function(t){var e=Math.floor(t/z);return 0!==(this.keys[e]&1<<t-e*z)}},{key:"isUp",value:function(t){return!this.isDown(t)}}]),t}(),$=Object(f["defineNode"])({animation:p},"AnimationNode"),J=Object(f["defineNode"])({asteroid:g,position:M,collision:b,audio:y},"AsteroidCollisionNode"),q=Object(f["defineNode"])({audio:y},"AudioNode"),Q=Object(f["defineNode"])({bullet:w,position:M,collision:b},"BulletCollisionNode"),tt=Object(f["defineNode"])({death:O},"DeathThroesNode"),et=Object(f["defineNode"])({state:E},"GameNode"),it=Object(f["defineNode"])({control:A,gun:_,position:M,audio:y},"GunControlNode"),nt=Object(f["defineNode"])({control:j,position:M,motion:T},"MotionControlNode"),at=Object(f["defineNode"])({position:M,motion:T,collision:b},"MovementNode"),ot=Object(f["defineNode"])({position:M,display:S},"RenderNode"),st=Object(f["defineNode"])({spaceship:D,position:M,collision:b,audio:y},"SpaceshipCollisionNode"),rt=Object(f["defineNode"])({spaceship:D,position:M},"SpaceshipNode"),ct=(Object(f["defineNode"])({shake:k},"CameraShakeNode"),function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(){return Object(s["a"])(this,i),e.call(this,$)}return Object(r["a"])(i,[{key:"updateNode",value:function(t,e){t.animation.animation.animate(e)}}]),i}(f["ListIteratingSystem"])),ht=(f["ListIteratingSystem"],i("4057"),i("4ec9"),i("3ca3"),i("d81d"),i("4533")),ut=i.n(ht),lt=i("58ce"),dt=i.n(lt),vt=i("b750"),mt=i.n(vt),ft=i("7e73"),pt=i.n(ft),gt=i("ced2"),yt=i.n(gt),wt=i("5cd1"),bt=i.n(wt);(function(t){t[t["asteroid"]=0]="asteroid",t[t["ship"]=1]="ship",t[t["shoot"]=2]="shoot"})(V||(V={}));var Ot=[{key:V.asteroid,mp3:ut.a,ogg:dt.a},{key:V.shoot,mp3:mt.a,ogg:pt.a},{key:V.ship,mp3:yt.a,ogg:bt.a}];function St(){var t=document.createElement("audio"),e=t.canPlayType("audio/mpeg"),i=t.canPlayType("audio/ogg"),n=null;return"probably"===e?n="mp3":"probably"===i?n="ogg":"maybe"===e?n="mp3":"maybe"===i&&(n="ogg"),n}function Et(t){return _t.apply(this,arguments)}function _t(){return _t=Object(m["a"])(regeneratorRuntime.mark((function t(e){var i,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=new Map,n=St(),a=function(){var t=Object(m["a"])(regeneratorRuntime.mark((function t(n,a){var o,s,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,fetch(n);case 2:return o=t.sent,t.next=5,o.arrayBuffer();case 5:return s=t.sent,t.next=8,e.decodeAudioData(s);case 8:r=t.sent,i.set(a,r);case 10:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}(),!n){t.next=6;break}return t.next=6,Promise.all(Ot.map((function(t){return a(t[n],t.key)})));case 6:return t.abrupt("return",i);case 7:case"end":return t.stop()}}),t)}))),_t.apply(this,arguments)}var At=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(t){var n;return Object(s["a"])(this,i),n=e.call(this),n.games=null,n.spaceships=null,n.asteroids=null,n.bullets=null,n.creator=t,n}return Object(r["a"])(i,[{key:"addToEngine",value:function(t){this.games=t.getNodeList(et),this.spaceships=t.getNodeList(st),this.asteroids=t.getNodeList(J),this.bullets=t.getNodeList(Q)}},{key:"update",value:function(t){for(var e=K.DEFAULT_ASTEROID_MAX_SIZE,i=Math.floor(e*(1/3)),n=Math.floor(e/6),a=this.bullets.head;a;a=a.next)for(var o=this.asteroids.head;o;o=o.next){var s=Math.hypot(o.position.x-a.position.x,o.position.y-a.position.y);if(s<=o.collision.radius){if(this.creator.destroyEntity(a.entity),o.collision.radius>i){var r=o.collision.radius-i,c=o.position.x+10*Math.random()-n,h=o.position.y+10*Math.random()-n;this.creator.createAsteroid(r,c,h),c=o.position.x+10*Math.random()-n,h=o.position.y+10*Math.random()-n,this.creator.createAsteroid(r,c,h)}o.asteroid.fsm.changeState("destroyed"),o.audio.play(V.asteroid),this.games.head&&(this.games.head.state.hits+=1);var u=o.collision.radius/K.DEFAULT_ASTEROID_MAX_SIZE,l=K.DEFAULT_CAMERA_SHAKE_MAGNITUDE_FOR_ASTEROID*u;this.creator.cameraShake(Math.floor(l),K.DEFAULT_CAMERA_SHAKE_TIME_FOR_ASTEROID*u);break}}for(var d=this.spaceships.head;d;d=d.next)for(var v=this.asteroids.head;v;v=v.next){var m=Math.hypot(v.position.x-d.position.x,v.position.y-d.position.y);if(m<=v.collision.radius+d.collision.radius){d.spaceship.fsm.changeState("destroyed"),d.audio.play(V.ship),this.games.head&&(this.games.head.state.lives-=1),this.creator.cameraShake(K.DEFAULT_CAMERA_SHAKE_MAGNITUDE_FOR_SPACESHIP,K.DEFAULT_CAMERA_SHAKE_TIME_FOR_SPACESHIP);break}}}},{key:"removeFromEngine",value:function(t){this.games=null,this.spaceships=null,this.asteroids=null,this.bullets=null}}]),i}(f["System"]),Tt=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(t){var n;return Object(s["a"])(this,i),n=e.call(this,tt),n.creator=t,n}return Object(r["a"])(i,[{key:"updateNode",value:function(t,e){t.death.countdown-=e,t.death.countdown<=0&&this.creator.destroyEntity(t.entity)}}]),i}(f["ListIteratingSystem"]),jt=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(t,n){var a;return Object(s["a"])(this,i),a=e.call(this),a.games=null,a.spaceships=null,a.asteroids=null,a.bullets=null,a.currentGameState="",a.creator=t,a.config=n,a}return Object(r["a"])(i,[{key:"addToEngine",value:function(t){this.games=t.getNodeList(et),this.spaceships=t.getNodeList(rt),this.asteroids=t.getNodeList(J),this.bullets=t.getNodeList(Q)}},{key:"removeFromEngine",value:function(t){this.games=null,this.spaceships=null,this.asteroids=null,this.bullets=null}},{key:"update",value:function(t){var e=this.games.head;if(e)if(e.state.state==E.PLAY){if(this.currentGameState==E.WAIT_FOR_START||this.currentGameState==E.FINISH)while(null!==(i=this.asteroids)&&void 0!==i&&i.head){var i;this.creator.destroyEntity(this.asteroids.head.entity)}if(this.currentGameState=e.state.state,this.spaceships.empty)if(e.state.lives){for(var n=this.config.width/2,a=this.config.height/2,o=Math.floor(1.7*K.DEFAULT_ASTEROID_MAX_SIZE),s=!0,r=this.asteroids.head;r;r=r.next){var c=Math.hypot(r.position.x-n,r.position.y-a);if(c<=r.collision.radius+o){s=!1;break}}s&&this.creator.createSpaceship()}else e.state.setForFinish();if(this.asteroids.empty&&this.bullets.empty&&this.spaceships.head){var h=this.spaceships.head;e.state.level+=1;for(var u=K.DEFAULT_ASTEROIDS_MIN_COUNT+e.state.level,l=Math.floor(2.7*K.DEFAULT_ASTEROID_MAX_SIZE),d=0;d<u;d+=1){var v=void 0,m=void 0;do{v=Math.random()*this.config.width,m=Math.random()*this.config.height}while(Math.hypot(v-h.position.x,m-h.position.y)<=l);this.creator.createAsteroid(K.DEFAULT_ASTEROID_MAX_SIZE,v,m)}}}else this.currentGameState=e.state.state}}]),i}(f["System"]),Mt=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(t,n,a){var o;return Object(s["a"])(this,i),o=e.call(this),o.guns=null,o.game=null,o.keyPoll=t,o.touchPoll=n,o.creator=a,o}return Object(r["a"])(i,[{key:"addToEngine",value:function(t){this.guns=t.getNodeList(it),this.game=t.getNodeList(et)}},{key:"removeFromEngine",value:function(t){this.guns=null,this.game=null}},{key:"update",value:function(t){for(var e=null===(i=this.guns)||void 0===i?void 0:i.head;e;e=null===(n=e)||void 0===n?void 0:n.next){var i,n,a=e,o=a.control,s=e,r=s.position,c=e,h=c.gun;h.shooting=this.keyPoll.isDown(o.trigger)||this.touchPoll.click,h.timeSinceLastShot+=t,h.shooting&&h.timeSinceLastShot>=h.minimumShotInterval&&(this.game&&this.game.head&&this.game.head.state.shots++,this.creator.createUserBullet(h,r),e.audio.play(V.shoot),h.timeSinceLastShot=0)}}}]),i}(f["System"]),Dt=i("91dc"),kt=i("2f62");n["a"].use(kt["b"]);var Rt,It=new kt["a"]({}),Ft=Object(Dt["createModule"])(It,"storeGameModule",{namespaced:!0,state:{state:E.WAIT_FOR_START,score:0,lives:0,level:0,hits:0,shots:0},mutations:{reset:function(t){t.state=E.WAIT_FOR_START,t.score=0,t.lives=0,t.level=0},setState:function(t,e){t.state=e},setScore:function(t,e){t.score=e},setLives:function(t,e){t.lives=e},setLevel:function(t,e){t.level=e},setHits:function(t,e){t.hits=e},setShots:function(t,e){t.shots=e}},getters:{level:function(t){var e=t.level;return e},state:function(t){var e=t.state;return e},score:function(t){var e=t.score;return e},lives:function(t){var e=t.lives;return e},hits:function(t){var e=t.hits;return e},shots:function(t){var e=t.shots;return e}}}),Ct=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(){var t;return Object(s["a"])(this,i),t=e.apply(this,arguments),t.game=null,t.gameState=new E,t}return Object(r["a"])(i,[{key:"addToEngine",value:function(t){this.game=t.getNodeList(et)}},{key:"removeFromEngine",value:function(t){this.game=null}},{key:"update",value:function(t){var e,i,n=null===(e=this.game)||void 0===e||null===(i=e.head)||void 0===i?void 0:i.state;n&&(Ft.getters.state!=this.gameState.state?this.gameState.state!=E.WAIT_FOR_START&&this.gameState.state!=E.FINISH||Ft.getters.state!=E.PLAY?Ft.getters.state==E.FINISH?(this.gameState.setForFinish(),n.setForFinish()):(this.gameState.state=Ft.getters.state,n.state=this.gameState.state):(this.gameState.setForStart(),n.setForStart()):(n.state!=this.gameState.state&&(this.gameState.state=n.state,Ft.mutations.setState(n.state)),Ft.mutations.setLives(n.lives),Ft.mutations.setLevel(n.level),Ft.mutations.setShots(n.shots),Ft.mutations.setHits(n.hits)),this.gameState.update(n))}}]),i}(f["System"]),Lt=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(t,n){var a;return Object(s["a"])(this,i),a=e.call(this,nt),a.keyPoll=t,a.touchPoll=n,a}return Object(r["a"])(i,[{key:"updateNode",value:function(t,e){var i=t.control,n=t.position,a=t.motion;(this.keyPoll.isDown(i.left)||this.touchPoll.left)&&(n.rotation-=i.rotationRate*e,a.velocityX+=Math.cos(n.rotation)*i.accelerationRate/2*e,a.velocityY+=Math.sin(n.rotation)*i.accelerationRate/2*e),(this.keyPoll.isDown(i.right)||this.touchPoll.right)&&(n.rotation+=i.rotationRate*e,a.velocityX+=Math.cos(n.rotation)*i.accelerationRate/2*e,a.velocityY+=Math.sin(n.rotation)*i.accelerationRate/2*e),(this.keyPoll.isDown(i.accelerate)||this.touchPoll.top)&&(a.velocityX+=Math.cos(n.rotation)*i.accelerationRate*e,a.velocityY+=Math.sin(n.rotation)*i.accelerationRate*e)}}]),i}(f["ListIteratingSystem"]),xt=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(t,n){var a;return Object(s["a"])(this,i),a=e.call(this,at),a.creator=t,a.config=n,a}return Object(r["a"])(i,[{key:"updateNode",value:function(t,e){var i=t.collision.radius,n=t.position,a=t.motion,o=this.config,s=o.width,r=o.height;n.x+=a.velocityX*e,n.y+=a.velocityY*e;var c=!1;if(n.x<-i&&(n.x+=s+2*i,c=!0),n.x>s+i&&(n.x-=s+2*i,c=!0),n.y<-i&&(n.y+=r+2*i,c=!0),n.y>r+i&&(n.y-=r+2*i,c=!0),c&&t.entity.get(w))this.creator.destroyEntity(t.entity);else if(n.rotation+=a.angularVelocity*e,a.damping>0){var h=Math.abs(Math.cos(n.rotation)*a.damping*e),u=Math.abs(Math.sin(n.rotation)*a.damping*e);a.velocityX>h?a.velocityX-=h:a.velocityX<-h?a.velocityX+=h:a.velocityX=0,a.velocityY>u?a.velocityY-=u:a.velocityY<-u?a.velocityY+=u:a.velocityY=0}}}]),i}(f["ListIteratingSystem"]),Nt=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{emitStageEvents:!0},o=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;Object(s["a"])(this,i),n=e.call(this),n.resized=!1,n.nodes=null,n.spaceship=null,n.addToDisplay=function(t){var e=t.display.displayObject;n.stage.addChild(e),n.options.emitStageEvents&&e.emit("addedToStage")},n.handleWindowResize=function(t){n.resized=!0},n.removeFromDisplay=function(t){var e=t.display.displayObject;n.stage.removeChild(e),n.options.emitStageEvents&&e.emit("removedFromStage")},n.container=t,n.options=a,n.entityCreator=o,n.gameConfig=r;var c=new I["a"]({width:n.gameConfig.width,height:n.gameConfig.height,backgroundColor:0});return n.renderer=c.renderer,n.stage=c.stage,n.view=c.view,n.entityCreator.registerCameraContainer(n.stage),n.resize(),n}return Object(r["a"])(i,[{key:"addToEngine",value:function(t){window.addEventListener("resize",this.handleWindowResize),this.container.appendChild(this.view),this.nodes=t.getNodeList(ot);for(var e=this.nodes.head;e;e=e.next)this.addToDisplay(e);this.nodes.nodeAdded.add(this.addToDisplay),this.nodes.nodeRemoved.add(this.removeFromDisplay),this.spaceship=t.getNodeList(rt)}},{key:"update",value:function(t){this.resized&&(this.resized=!1,this.resize());for(var e=this.nodes.head;e;e=e.next){var i=e,n=i.display,a=i.position;n.displayObject.setTransform(a.x,a.y,1,1,a.rotation)}this.renderer.render(this.stage)}},{key:"resize",value:function(){var t=this.container.getBoundingClientRect(),e=t.width*t.height,i=e/K.DEFAULT_SCREEN_SIZE_AREA;this.gameConfig.width=t.width/i,this.gameConfig.height=t.height/i,this.stage.scale.set(i,i),this.renderer.view.style.width=t.width+"px",this.renderer.view.style.height=t.height+"px",this.renderer.resize(t.width,t.height)}},{key:"removeFromEngine",value:function(t){this.nodes&&(this.nodes.nodeAdded.remove(this.addToDisplay),this.nodes.nodeRemoved.remove(this.removeFromDisplay),this.nodes=null),this.spaceship=null,this.container.removeChild(this.view)}}]),i}(f["System"]);(function(t){t[t["preUpdate"]=1]="preUpdate",t[t["update"]=2]="update",t[t["move"]=3]="move",t[t["resolveCollisions"]=4]="resolveCollisions",t[t["animate"]=5]="animate",t[t["render"]=6]="render",t[t["audio"]=7]="audio"})(Rt||(Rt={}));var Pt=function(){function t(){var e=this;Object(s["a"])(this,t),this.mouseDown=!1,this.mouseDownX=0,this.mouseDownY=0,this.mouseDownTimestamp=0,this.mouseDownRadius=20,this.mouseMoveX=0,this.mouseMoveY=0,this.clickTimeout=200,this.distance=0,this.mouseLeft=!1,this.mouseRight=!1,this.mouseTop=!1,this.mouseBottom=!1,this.handleTouchStart=function(t){t.preventDefault(),e.mouseDown=!0,e.mouseDownX=t.touches[0].clientX,e.mouseDownY=t.touches[0].clientY,e.mouseDownTimestamp=Date.now()},this.handleTouchEnd=function(t){t.preventDefault(),e.handleTouchMove(t),e.mouseDown=!1,e.resetDirections()},this.handleTouchMove=function(t){t.preventDefault(),e.mouseDown&&(e.mouseMoveX=t.touches[0].clientX,e.mouseMoveY=t.touches[0].clientY,e.distance=e.getDistance(e.mouseDownX,e.mouseDownY,e.mouseMoveX,e.mouseMoveY),e.distance>e.mouseDownRadius?e.mouseDownY-e.mouseMoveY>e.mouseDownRadius?e.mouseTop=!0:e.mouseDownX-e.mouseMoveX>e.mouseDownRadius?e.mouseLeft=!0:e.mouseMoveX-e.mouseDownX>e.mouseDownRadius?e.mouseRight=!0:e.mouseBottom=!0:e.resetDirections())},this.handleMouseDown=function(t){t.preventDefault(),e.mouseDown=!0,e.mouseDownX=t.clientX,e.mouseDownY=t.clientY,e.mouseDownTimestamp=Date.now()},this.handleMouseUp=function(t){t.preventDefault(),e.handleMouseMove(t),e.mouseDown=!1,e.resetDirections()},this.handleMouseMove=function(t){t.preventDefault(),e.mouseDown&&(e.mouseMoveX=t.clientX,e.mouseMoveY=t.clientY,e.distance=e.getDistance(e.mouseDownX,e.mouseDownY,e.mouseMoveX,e.mouseMoveY),e.distance>e.mouseDownRadius?e.mouseDownY-e.mouseMoveY>e.mouseDownRadius?e.mouseTop=!0:e.mouseDownX-e.mouseMoveX>e.mouseDownRadius?e.mouseLeft=!0:e.mouseMoveX-e.mouseDownX>e.mouseDownRadius?e.mouseRight=!0:e.mouseBottom=!0:e.resetDirections())},window.addEventListener("mousedown",this.handleMouseDown),window.addEventListener("mouseup",this.handleMouseUp),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("touchstart",this.handleTouchStart),window.addEventListener("touchend",this.handleTouchEnd),window.addEventListener("touchmove",this.handleTouchMove)}return Object(r["a"])(t,[{key:"getDistance",value:function(t,e,i,n){var a=t-i,o=e-n;return Math.sqrt(a*a+o*o)}},{key:"resetDirections",value:function(){this.mouseLeft=!1,this.mouseRight=!1,this.mouseTop=!1,this.mouseBottom=!1}},{key:"left",get:function(){return this.mouseLeft}},{key:"right",get:function(){return this.mouseRight}},{key:"top",get:function(){return this.mouseTop}},{key:"down",get:function(){return this.mouseBottom}},{key:"click",get:function(){return!this.mouseDown&&Date.now()-this.mouseDownTimestamp<=this.clickTimeout&&this.distance<this.mouseDownRadius}}]),t}();function Xt(t){return Ut.apply(this,arguments)}function Ut(){return Ut=Object(m["a"])(regeneratorRuntime.mark((function t(e){var i,n,a,o,s,r,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=new K(e.clientWidth,e.clientHeight),n=new f["Engine"],a=new W(n,i),o=new Z,s=new Pt,r=new f["FrameTickProvider"],c=new AudioContext,t.next=9,Et(c);case 9:t.sent,r.add((function(t){return n.update(t)})),r.start(),n.addSystem(new jt(a,i),Rt.preUpdate),n.addSystem(new Lt(o,s),Rt.update),n.addSystem(new Mt(o,s,a),Rt.update),n.addSystem(new Tt(a),Rt.update),n.addSystem(new xt(a,i),Rt.move),n.addSystem(new At(a),Rt.resolveCollisions),n.addSystem(new ct,Rt.animate),n.addSystem(new Ct,Rt.preUpdate),n.addSystem(new Nt(e,{emitStageEvents:!0},a,i),Rt.render),a.createGame();case 22:case"end":return t.stop()}}),t)}))),Ut.apply(this,arguments)}var Yt=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(){return Object(s["a"])(this,i),e.apply(this,arguments)}return Object(r["a"])(i,[{key:"mounted",value:function(){var t=this;Ft.mutations.reset(),setTimeout((function(){Xt(t.$refs.game)}),100)}},{key:"destroyed",value:function(){console.log("Game","destroyed")}},{key:"start",get:function(){return Ft.getters.state==E.WAIT_FOR_START}},{key:"finish",get:function(){return Ft.getters.state==E.FINISH}},{key:"precision",get:function(){var t=Math.floor(Ft.getters.hits/Ft.getters.shots*100);return t?"".concat(t,"%"):""}},{key:"handleClick",value:function(){Ft.getters.state!=E.WAIT_FOR_START&&Ft.getters.state!=E.FINISH||Ft.mutations.setState(E.PLAY)}}]),i}(l["b"]);Yt=Object(u["a"])([Object(l["a"])({components:{}})],Yt);var Ht=Yt,Gt=Ht,Bt=(i("690a"),i("2877")),Wt=Object(Bt["a"])(Gt,d,v,!1,null,"883e05de",null),Kt=Wt.exports,Vt=function(t){Object(c["a"])(i,t);var e=Object(h["a"])(i);function i(){return Object(s["a"])(this,i),e.apply(this,arguments)}return Object(r["a"])(i,[{key:"mounted",value:function(){console.log("App mounted")}}]),i}(l["b"]);Vt=Object(u["a"])([Object(l["a"])({components:{Game:Kt}})],Vt);var zt=Vt,Zt=zt,$t=Object(Bt["a"])(Zt,a,o,!1,null,null,null),Jt=$t.exports,qt=function(){function t(){var e=this;Object(s["a"])(this,t),this.viewportWidth=0,Promise.all([this.setupBridge(),this.setupVK()]).then((function(){e.setupIFrame()})).catch((function(t){}))}return Object(r["a"])(t,[{key:"handleBridgeSubscribe",value:function(t){switch(console.log("vkBridge event",t),t.type){case"VKWebAppUpdateConfig":console.log("e.data.viewport_width, e.data.viewport_height",t.data.viewport_width,t.data.viewport_height),this.viewportWidth=t.data.viewport_width;break;case"VKWebAppResizeWindowResult":console.log("VKWebAppResizeWindowResult",t.data.width,t.data.height);break}}},{key:"handleOnScrollTop",value:function(t,e,i){console.log("handleOnScrollTop",e)}},{key:"setupBridge",value:function(){var t=this;return new Promise((function(e,i){var n=function t(){vkBridge.unsubscribe(t),e(!0)};vkBridge.subscribe(n),vkBridge.subscribe((function(e){t.handleBridgeSubscribe(e)})),vkBridge.send("VKWebAppInit",{})}))}},{key:"setupVK",value:function(){return new Promise((function(t,e){VK.init((function(){t(!0)}),(function(){e(!1)}),"5.130")}))}},{key:"setupIFrame",value:function(){var t=this;VK.addCallback("onScrollTop",(function(e,i,n){t.handleOnScrollTop(e,i,n)})),VK.callMethod("scrollTop")}}]),t}();n["a"].config.productionTip=!1,new n["a"]({store:It,render:function(t){return t(Jt)}}).$mount("#app"),new qt},ced2:function(t,e,i){t.exports=i.p+"media/ship.fc37c3a9.mp3"}});
//# sourceMappingURL=app.401a0ea3.js.map